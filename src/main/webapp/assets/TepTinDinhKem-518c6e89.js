import{e as ce,A as f,h as de,B as O,N as U,o as he,i as u,G as y,d as l,w as a,I as K,H as R,l as g,j as d,k as r,F as _,v as s,D as S,E as X,t as c,q as m,s as z,M,O as pe,R as Te,K as fe,L as ye}from"./index-af2df877.js";import{$ as Q}from"./jquery-da988d60.js";import{u as ge}from"./hosodvc-ad889d3d.js";import{t as V}from"./toastr-b359f669.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{V as q,a as Y}from"./VRow-bee11424.js";import{V as I}from"./VTooltip-4cdaab80.js";import{V as P,a as W,b as De}from"./VCard-98977f8b.js";import{a as J,b as Z,c as ee,V as oe}from"./VToolbarItems-34e8de7b.js";import{V as Se}from"./VForm-9f550b47.js";const x=b=>(fe("data-v-6a0a78c6"),b=b(),ye(),b),ve={style:{"font-weight":"600",width:"100%"}},me={key:0,style:{color:"red"}},xe=["onClick"],Ge=x(()=>r("span",null,"Tải xuống",-1)),Me=x(()=>r("span",null,"Xóa",-1)),He={key:1,style:{width:"100%"}},ke={style:{width:"100%"},class:""},we={key:0},Le=["onClick"],be={class:"ml-2",style:{"font-size":"14px","text-decoration":"underline",color:"#1E7D30",cursor:"pointer"}},Ce=x(()=>r("span",null,"Tải xuống",-1)),Ee=x(()=>r("span",null,"Xóa",-1)),Be={key:6},ze={style:{width:"100%"}},Ve={style:{"font-size":"14px","text-transform":"none"}},Ie=x(()=>r("div",{class:"sub-header-content"}," Tên giấy tờ ",-1)),$e=x(()=>r("div",{class:"triangle-header"},null,-1)),Ae=x(()=>r("div",{class:"sub-header-content"}," Tệp tin đính kèm ",-1)),Ke=x(()=>r("div",{class:"triangle-header"},null,-1)),Pe=["src"],Fe={__name:"TepTinDinhKem",props:{permission:{type:Boolean,default:!1}},setup(b){V.options={closeButton:!0,timeOut:"5000",positionClass:"toast-top-center"},ce();const H=f("#1E7D30"),h=de(),$=ge();f(!1);const k=f(!1),C=f(!1),F=f(""),w=f(""),N=f(null),G=f(!1),p=O(function(){return h.thongTinHoSo}),A=O(function(){let n=h.thongTinHoSo.ThanhPhanHoSo.filter(function(o){return!o.MaThanhPhanHoSo||o.MaThanhPhanHoSo&&o.MaThanhPhanHoSo.MaMuc.split("_")[0]!=="BMDT"});return h.thongTinHoSo.TrangThaiHoSo.MaMuc=="05"?n.forEach((o,e)=>{n[e].itemsGiayTo=n.filter(function(i){let t=i.IDGiayTo.split("-");return(t[0]=="GTK"||t[0]=="GTBS")&&t[1]==o.IDGiayTo})}):n.forEach((o,e)=>{o.HinhThucGiayTo.MaMuc=="true"&&(n[e].itemsGiayTo=n.filter(function(i){let t=i.IDGiayTo.split("-");return(t[0]=="GTK"||t[0]=="GTBS")&&t[1]==o.IDGiayTo}))}),n.filter(function(o){return String(o.IDGiayTo).split("-")[0]!=="GTK"&&String(o.IDGiayTo).split("-")[0]!=="GTBS"})}),v=f(null),E=f(null);U([{sortable:!1,title:"Tên giấy tờ",align:"left",key:"tenGiayTo",class:"td-left"},{sortable:!1,title:"Tệp đính kèm",align:"left",key:"tepDinhKem",class:"td-left"}]),U([{sortable:!1,title:"TT",align:"center",key:"index",class:"td-left"},{sortable:!1,title:"Tên giấy tờ",align:"left",key:"tepDinhKem",class:"td-left"}]);const j=function(n){const o=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),t=String(n.getHours()).padStart(2,"0"),D=String(n.getMinutes()).padStart(2,"0"),T=String(n.getSeconds()).padStart(2,"0");return`${o}-${e}-${i}T${t}:${D}:${T}`},ae=function(n){let o=new Date(n);return`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`},te=function(n,o){v.value=n,E.value=o,document.getElementById("file_upload_tep_dinh_kem").value="",document.getElementById("file_upload_tep_dinh_kem").click()},ne=function(n){console.log("fileUpload",n);let o=n.name?n.name.split("."):"",e=o?o[o.length-1]:"",i=["png","jpg","jpeg","pdf","docx","doc","xls","xlsx","txt","rtf"],t=10;try{t=fileSizeAllowConfig||10}catch{}try{i=fileTypeAllowConfig||["png","jpg","jpeg","pdf","docx","doc","xls","xlsx","txt","rtf"]}catch{}let D=i?i.filter(function(L){return L===String(e).toLocaleLowerCase()}):"",T=!1;return D&&D.length>0?Number(n.size)<=t*1048576?T=!0:(V.error("Tài liệu tải lên dung lượng tối đa là "+t+" MB"),T=!1):(V.error("Tài liệu tải lên chỉ chấp nhận các định dạng "+i.toString()),T=!1),T},le=function(){let n=Q("#file_upload_tep_dinh_kem")[0].files[0];ne(n)&&(v.value.HinhThucGiayTo.MaMuc=="true"?ue():$.uploadTep(n).then(function(e){if(p.value.TrangThaiHoSo.MaMuc=="05"){let i={IDGiayTo:"GTBS-"+v.value.IDGiayTo,TenGiayTo:v.value.TenGiayTo,SoBanGiay:0,HinhThucGiayTo:{MaMuc:"",TenMuc:""},NgayBoSung:j(new Date),MaThanhPhanHoSo:v.value.MaThanhPhanHoSo,MaGiayToKetQua:null,DaHuyBoThayThe:!1,TinhTrangSoHoa:1,GiayToCaNhanToChuc:{MaDinhDanh:"",TenGiayTo:""},TepDuLieu:e.resp,GiayToLuuTruSo:{MaDinhDanh:"",TenGiayTo:""},DuLieuDienTu:{MaDinhDanh:""},editting:!0};h.$patch(t=>{t.thongTinHoSo.ThanhPhanHoSo[E.value+1].DaHuyBoThayThe=!0}),h.$patch(t=>{t.thongTinHoSo.ThanhPhanHoSo.push(i)}),h.$patch(t=>{t.thongTinHoSo.ThanhPhanHoSo[E.value+1].block=!0})}else h.$patch(i=>{i.thongTinHoSo.ThanhPhanHoSo[E.value+1].TepDuLieu=e.resp});console.log("tphsAddthanhPhanHoSo",A.value)}).catch(function(e){}))},B=function(n,o){G.value||(G.value=!0,$.taiTep(n).then(function(e){if(G.value=!1,o=="preview")F.value=e,C.value=!0;else{var i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=e,i.download=n.TenTep,i.click()}}).catch(function(e){G.value=!1}))},ie=function(n,o){h.$patch(e=>{e.thongTinHoSo.ThanhPhanHoSo[o+1].TepDuLieu={DinhDangTep:"",DuongDanURL:"",Ext:"unknown",KichThuocTep:0,MaDinhDanh:"",TenTep:""}})},ue=function(){w.value="",k.value=!0},se=async function(){const{valid:n}=await N.value.validate();if(n){let o=Q("#file_upload_tep_dinh_kem")[0].files[0];$.uploadTep(o).then(function(e){k.value=!1;let i={IDGiayTo:"GTK-"+v.value.IDGiayTo,TenGiayTo:w.value,SoBanGiay:0,HinhThucGiayTo:{MaMuc:"",TenMuc:""},NgayBoSung:null,MaThanhPhanHoSo:null,MaGiayToKetQua:null,DaHuyBoThayThe:!1,TinhTrangSoHoa:1,GiayToCaNhanToChuc:{MaDinhDanh:"",TenGiayTo:""},TepDuLieu:e.resp,GiayToLuuTruSo:{MaDinhDanh:"",TenGiayTo:""},DuLieuDienTu:{MaDinhDanh:""},editting:!0};p.value.TrangThaiHoSo.MaMuc=="05"&&(i={IDGiayTo:"GTBS-"+v.value.IDGiayTo,TenGiayTo:w.value,SoBanGiay:0,HinhThucGiayTo:{MaMuc:"",TenMuc:""},NgayBoSung:j(new Date),MaThanhPhanHoSo:v.value.MaThanhPhanHoSo,MaGiayToKetQua:null,DaHuyBoThayThe:!1,TinhTrangSoHoa:1,GiayToCaNhanToChuc:{MaDinhDanh:"",TenGiayTo:""},TepDuLieu:e.resp,GiayToLuuTruSo:{MaDinhDanh:"",TenGiayTo:""},DuLieuDienTu:{MaDinhDanh:""},editting:!0}),h.$patch(t=>{t.thongTinHoSo.ThanhPhanHoSo.push(i)}),console.log("tphsAddthanhPhanHoSo",A.value)}).catch(function(e){V.error("Tải lên giấy tờ thất bại")})}},re=function(n,o){h.SET_SHOWCONFIRM(!0);let e={auth:!1,title:"Xóa giấy tờ",message:"Bạn có chắc chắn muốn xóa giấy tờ này",button:{yes:"Có",no:"Không"},callback:()=>{h.$patch(i=>{i.thongTinHoSo.ThanhPhanHoSo[o+1].itemsGiayTo.splice(n,1)}),h.$patch(i=>{i.thongTinHoSo.ThanhPhanHoSo[o+1].block=!1})}};h.SET_CONFIG_CONFIRM_DIALOG(e)};return he(()=>{}),(n,o)=>(u(),y(K,null,[l(P,{class:"pa-0 thanhphanhoso",style:{"box-shadow":"none !important",width:"100%"}},{default:a(()=>[l(q,{class:"mx-0 my-0",style:{"border-top":"1px solid #DADADA","border-left":"1px solid #DADADA"}},{default:a(()=>[(u(!0),y(K,null,R(g(A),(e,i)=>(u(),d(q,{key:e.IDGiayTo,class:"mx-0 my-0 px-2 py-2",style:{width:"100%","border-bottom":"1px solid #DADADA","border-right":"1px solid #DADADA","align-items":"center","min-height":"42px"}},{default:a(()=>[r("div",ve,[r("span",null,_(i+1)+". ",1),r("span",null,_(e.TenGiayTo),1),s(),e.HinhThucGiayTo.TenMuc=="true"?(u(),y("span",me,"(*)")):S("",!0)]),e.TepDuLieu.KichThuocTep?(u(),y("div",{key:0,class:"py-1",onClick:t=>B(e.TepDuLieu,"preview"),style:X(e.DaHuyBoThayThe?"width: 100%; opacity: 0.8":"width: 100%")},[e.TepDuLieu.Ext==="xls"||e.TepDuLieu.Ext==="xlsx"?(u(),d(c,{key:0,size:"18",color:"green"},{default:a(()=>[s("mdi-file-excel-outline")]),_:1})):e.TepDuLieu.Ext==="doc"||e.TepDuLieu.Ext==="docx"?(u(),d(c,{key:1,size:"18",color:"blue"},{default:a(()=>[s("mdi-file-word-outline")]),_:1})):e.TepDuLieu.Ext==="pdf"?(u(),d(c,{key:2,size:"18",color:"red"},{default:a(()=>[s("mdi-file-pdf-box")]),_:1})):e.TepDuLieu.Ext==="png"||e.TepDuLieu.Ext==="jpg"||e.TepDuLieu.Ext==="jpeg"?(u(),d(c,{key:3,size:"18",color:"blue"},{default:a(()=>[s("mdi-file-image")]),_:1})):(u(),d(c,{key:4,size:"18",color:"#2161b1"},{default:a(()=>[s("mdi-paperclip")]),_:1})),r("a",{class:"ml-2",style:X(e.DaHuyBoThayThe?"color: grey;text-decoration: underline;cursor: pointer":"text-decoration: underline;color: #1E7D30;cursor: pointer")},_(e.TepDuLieu.TenTep)+"."+_(e.TepDuLieu.Ext),5),l(I,{location:"top"},{activator:a(({props:t})=>[l(m,z({icon:"",variant:"flat",size:"small"},t,{class:"mr-0",onClick:M(D=>B(e.TepDuLieu,"download"),["stop"])}),{default:a(()=>[l(c,{size:"18",color:H.value},{default:a(()=>[s("mdi-cloud-download-outline")]),_:1},8,["color"])]),_:2},1040,["onClick"])]),default:a(()=>[Ge]),_:2},1024),!g(p).TrangThaiHoSo||g(p)&&g(p).TrangThaiHoSo.MaMuc==""||e.hasOwnProperty("editting")?(u(),d(I,{key:5,location:"top"},{activator:a(({props:t})=>[l(m,z({icon:"",variant:"flat",size:"small"},t,{class:"mr-2",onClick:M(D=>ie(e,i),["stop"])}),{default:a(()=>[l(c,{size:"18",color:"red"},{default:a(()=>[s("mdi-close")]),_:1})]),_:2},1040,["onClick"])]),default:a(()=>[Me]),_:2},1024)):S("",!0),r("i",null,_(e.DaHuyBoThayThe?"(Đã hủy bỏ/thay thế)":""),1)],12,xe)):S("",!0),e.HinhThucGiayTo.MaMuc=="true"||e.hasOwnProperty("itemsGiayTo")&&e.itemsGiayTo?(u(),y("div",He,[(u(!0),y(K,null,R(e.itemsGiayTo,(t,D)=>(u(),y("div",{key:D},[r("div",ke,[e.HinhThucGiayTo.MaMuc=="true"?(u(),y("span",we,"- "+_(t.TenGiayTo)+": ",1)):S("",!0),t.TepDuLieu.KichThuocTep?(u(),y("span",{key:1,class:"py-1",onClick:T=>B(t.TepDuLieu,"preview")},[t.TepDuLieu.Ext==="xls"||t.TepDuLieu.Ext==="xlsx"?(u(),d(c,{key:0,size:"18",color:"green"},{default:a(()=>[s("mdi-file-excel-outline")]),_:1})):t.TepDuLieu.Ext==="doc"||t.TepDuLieu.Ext==="docx"?(u(),d(c,{key:1,size:"18",color:"blue"},{default:a(()=>[s("mdi-file-word-outline")]),_:1})):t.TepDuLieu.Ext==="pdf"?(u(),d(c,{key:2,size:"18",color:"red"},{default:a(()=>[s("mdi-file-pdf-box")]),_:1})):t.TepDuLieu.Ext==="png"||t.TepDuLieu.Ext==="jpg"||t.TepDuLieu.Ext==="jpeg"?(u(),d(c,{key:3,size:"18",color:"blue"},{default:a(()=>[s("mdi-file-image")]),_:1})):(u(),d(c,{key:4,size:"18",color:"#2161b1"},{default:a(()=>[s("mdi-paperclip")]),_:1})),r("a",be,_(t.TepDuLieu.TenTep)+"."+_(t.TepDuLieu.Ext),1),l(I,{location:"top"},{activator:a(({props:T})=>[l(m,z({icon:"",variant:"flat",size:"small"},T,{class:"mr-0",onClick:M(L=>B(t.TepDuLieu,"download"),["stop"])}),{default:a(()=>[l(c,{size:"18",color:H.value},{default:a(()=>[s("mdi-cloud-download-outline")]),_:1},8,["color"])]),_:2},1040,["onClick"])]),default:a(()=>[Ce]),_:2},1024),!g(p).TrangThaiHoSo||g(p)&&g(p).TrangThaiHoSo.MaMuc==""||t.hasOwnProperty("editting")?(u(),d(I,{key:5,location:"top"},{activator:a(({props:T})=>[l(m,z({icon:"",variant:"flat",size:"small"},T,{class:"mr-2",onClick:M(L=>re(D,i),["stop"])}),{default:a(()=>[l(c,{size:"18",color:"red"},{default:a(()=>[s("mdi-close")]),_:1})]),_:2},1040,["onClick"])]),default:a(()=>[Ee]),_:2},1024)):S("",!0),t.NgayBoSung?(u(),y("i",Be,"(Ngày bổ sung: "+_(ae(t.NgayBoSung))+")",1)):S("",!0)],8,Le)):S("",!0)])]))),128))])):S("",!0),r("div",ze,[e.HinhThucGiayTo.MaMuc=="true"||e.HinhThucGiayTo.MaMuc=="false"&&!e.TepDuLieu.KichThuocTep||g(p).TrangThaiHoSo.MaMuc=="05"&&!e.block?(u(),d(m,{key:0,class:"mx-0 ml-2 mt-2",size:"small",variant:"outlined",color:"#1E7D30",onClick:M(t=>te(e,i),["stop"]),height:"28px"},{default:a(()=>[l(c,{size:"22",color:"#1E7D30",class:"mr-2"},{default:a(()=>[s("mdi-cloud-upload-outline")]),_:1}),r("span",Ve,_(g(p).TrangThaiHoSo&&g(p).TrangThaiHoSo.MaMuc=="05"?"Bổ sung giấy tờ":"Tải lên tệp"),1)]),_:2},1032,["onClick"])):S("",!0)])]),_:2},1024))),128))]),_:1}),r("input",{type:"file",id:"file_upload_tep_dinh_kem",multiple:!1,onInput:o[0]||(o[0]=e=>le()),style:{display:"none"}},null,32)]),_:1}),l(oe,{"max-width":"900",modelValue:k.value,"onUpdate:modelValue":o[4]||(o[4]=e=>k.value=e),persistent:""},{default:a(()=>[l(P,null,{default:a(()=>[l(J,{dark:"",color:H.value,class:"px-0"},{default:a(()=>[l(Y,{class:"sub-header d-flex align-center justify-start py-0 px-0"},{default:a(()=>[Ie,$e]),_:1}),l(Z),l(ee,null,{default:a(()=>[l(m,{variant:"flat",size:"small",icon:"",color:"#E9FFF2",onClick:o[1]||(o[1]=e=>k.value=!1)},{default:a(()=>[l(c,{size:"20"},{default:a(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1})]),_:1},8,["color"]),l(W,{class:"mt-2 px-3"},{default:a(()=>[l(Se,{ref_key:"formGiayToKhac",ref:N,"lazy-validation":"",class:"py-0"},{default:a(()=>[l(pe,{modelValue:w.value,"onUpdate:modelValue":o[2]||(o[2]=e=>w.value=e),placeholder:"Nhập tên giấy tờ",dense:"","hide-details":"auto",class:"input-form",clearable:"",required:"",rules:[e=>e!==""&&e!==null&&e!==void 0||"Thông tin bắt buộc"],onKeyup:o[3]||(o[3]=Te(()=>{},["enter"]))},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),l(De,{class:"justify-center pb-3 px-3"},{default:a(()=>[l(m,{size:"small",variant:"elevated",loading:G.value,disabled:G.value,color:H.value,"prepend-icon":"mdi-content-save",onClick:M(se,["stop"])},{default:a(()=>[s(" Đồng ý ")]),_:1},8,["loading","disabled","color","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(oe,{"max-width":"1000",modelValue:C.value,"onUpdate:modelValue":o[6]||(o[6]=e=>C.value=e),persistent:""},{default:a(()=>[l(P,null,{default:a(()=>[l(J,{dark:"",color:H.value,class:"px-0"},{default:a(()=>[l(Y,{class:"sub-header d-flex align-center justify-start py-0 px-0"},{default:a(()=>[Ae,Ke]),_:1}),l(Z),l(ee,null,{default:a(()=>[l(m,{variant:"flat",size:"small",icon:"",color:"#E9FFF2",onClick:o[5]||(o[5]=e=>C.value=!1)},{default:a(()=>[l(c,{size:"20"},{default:a(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1})]),_:1},8,["color"]),l(W,{class:"my-0 px-0 py-0"},{default:a(()=>[r("iframe",{src:F.value,type:"application/pdf",width:"100%",height:"100%",style:{overflow:"auto","min-height":"600px"},frameborder:"0"},`\r
        `,8,Pe)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Je=_e(Fe,[["__scopeId","data-v-6a0a78c6"]]);export{Je as default};
