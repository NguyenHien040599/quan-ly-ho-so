import{y as H,U as M,M as $,A as b,i as n,j as u,w as s,d as p,G as F,I as P,H as z,J as G,k as L,v as D,F as R,D as i,N as g,l as C,t as E}from"./index-fe848f2d.js";import{$ as Y}from"./jquery-da988d60.js";import{l as q}from"./main-689c90e4.js";import{V as J}from"./VForm-169f16b1.js";import{V as w,a as f}from"./VRow-09778906.js";import{V as K}from"./VTextarea-558e9c4b.js";import{V as A}from"./VAutocomplete-2fe2a3ce.js";import{V as Q}from"./VCard-8b59fd30.js";const{cookies:W}=H(),X=M("crudStore",{state:()=>({baseURL:"http://119.17.200.66:8023"}),getters:{},actions:{async loadDataSource(c){let m=c.api;c.api.indexOf("http")<0&&(m=this.baseURL+c.api);let k={url:m,method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+W.get("Token")},data:{}};return await Y.ajax(k)}}}),Z={key:0,style:{color:"red"}},pe={__name:"FormCRUD",props:{mauNhap:{type:Object,default:{}},dataInput:{type:Object,default:{}}},emits:["submitForm"],setup(c,{expose:m,emit:k}){const y=c,B=X(),d=$(y.mauNhap),T=$(y.dataInput),t=b({}),U=b(!1),I=function(r){let l=Object.assign({},t.value);for(let e in d){let o=d[e];if(o.type=="date"&&l[o.name]&&(l[o.name]=O(l[o.name])),o.type=="money"&&l[o.name]&&(l[o.name]=Number(l[o.name].toString().replace(/\./g,""))),o.type=="select"&&l[o.name]){let a=Array.isArray(l[o.name])?l[o.name]:[l[o.name]],_=Array.from(a,function(S){let x={};return x[o.itemText]=S[o.itemText],x[o.itemValue]=S[o.itemValue],x});l[o.name]=_}}return l},V=r=>{try{if(r.getDate()){const l=r.getDate(),e=r.getMonth()+1,o=r.getFullYear();return`${l.toString().padStart(2,"0")}/${e.toString().padStart(2,"0")}/${o}`}}catch{}},h=r=>{console.log("dateInput",t.value[r])},v=b({format:"dd/MM/yyyy"}),N=function(r){for(let l in d){let e=d[l];e.type==="select"&&e.hasOwnProperty("api")&&e.api&&(!d[l].dataSource||d[l].dataSource.length==0)&&B.loadDataSource(e).then(function(o){let a=e.responseDataApi?o[e.responseDataApi]:o;d[l].dataSource=a}).catch(function(){})}if(r==="update"&&T){t.value=Object.assign({},T),console.log("dataInputForm",t.value);for(let l in t.value){let e=d.find(function(o){return o.name==l});e&&e.type==="date"&&(t.value[l]=j(t.value[l])),e&&e.type==="money"&&(t.value[l]=currency(t.value[l])),e&&e.type==="select"&&!e.multiple&&(t.value[l]=Array.isArray(t.value[l])?t.value[l][0]:t.value[l])}this.$refs.formCrud.resetValidation()}else console.log("mauNhapForm",d),this.$refs.formCrud.reset(),this.$refs.formCrud.resetValidation()},j=function(r){if(!r)return"";let l=new Date(r);return`${l.getDate().toString().padStart(2,"0")}/${(l.getMonth()+1).toString().padStart(2,"0")}/${l.getFullYear()}`},O=function(r){if(!r)return"";const[l,e,o]=r.split("/");let a=`${o}-${e.padStart(2,"0")}-${l.padStart(2,"0")}`;return new Date(a).getTime()};return m({initForm:N,resetForm:function(){this.$refs.formCrud.reset(),this.$refs.formCrud.resetValidation()},resetFormValidation:function(){this.$refs.formCrud.resetValidation()},validateForm:async function(){const{valid:r}=await this.$refs.formCrud.validate();return r},submit:I,data:t}),(r,l)=>(n(),u(Q,{class:"mx-auto",flat:""},{default:s(()=>[p(J,{ref:"formCrud","lazy-validation":"",class:"py-0",modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value=e)},{default:s(()=>[p(w,{class:"my-0"},{default:s(()=>[(n(!0),F(P,null,z(c.mauNhap,(e,o)=>(n(),u(f,{key:o,class:G([e.fieldClass,"py-0 mb-2"])},{default:s(()=>[L("label",null,[D(R(e.title)+" ",1),e.required?(n(),F("span",Z,"(*)")):i("",!0)]),e.type==="textfield"?(n(),u(g,{key:0,class:"flex input-form",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,placeholder:e.placeHolder,solo:"",dense:"","hide-details":"auto",clearable:!e.readonly,required:e.required,rules:e.required?[a=>a!==""&&a!==null&&a!==void 0||"Thông tin bắt buộc"]:[],readonly:e.readonly},null,8,["modelValue","onUpdate:modelValue","placeholder","clearable","required","rules","readonly"])):i("",!0),e.type==="number"?(n(),u(g,{key:1,class:"flex input-form",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,placeholder:e.placeHolder,solo:"",dense:"","hide-details":"auto",clearable:!e.readonly,type:"number",required:e.required,rules:e.required?[a=>a!==""&&a!==null&&a!==void 0||"Thông tin bắt buộc"]:[],onInput:a=>!r.readonly&&e.hasOwnProperty("keyCalculator")?r.triggerCalculator(e.keyCalculator):"",readonly:e.readonly},null,8,["modelValue","onUpdate:modelValue","placeholder","clearable","required","rules","onInput","readonly"])):i("",!0),e.type==="textarea"?(n(),u(K,{key:2,class:"flex input-form",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,placeholder:e.placeHolder,solo:"",dense:"","hide-details":"auto",clearable:!e.readonly,rows:e.hasOwnProperty("rows")?e.rows:3,readonly:e.readonly,required:e.required,rules:e.required?[a=>a!==""&&a!==null&&a!==void 0||"Thông tin bắt buộc"]:[]},null,8,["modelValue","onUpdate:modelValue","placeholder","clearable","rows","readonly","required","rules"])):i("",!0),e.type==="date"?(n(),u(C(q),{key:3,class:"flex",position:"left","select-text":"Chọn","cancel-text":"Thoát",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,"text-input":"",format:V,placeholder:"dd/mm/yyyy","text-input-options":v.value,onBlur:a=>h(e.name)},null,8,["modelValue","onUpdate:modelValue","text-input-options","onBlur"])):i("",!0),e.type==="daterange"?(n(),u(w,{key:4},{default:s(()=>[p(f,null,{default:s(()=>[p(C(q),{class:"flex",position:"left","select-text":"Chọn","cancel-text":"Thoát",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,"text-input":"",format:V,placeholder:"dd/mm/yyyy","text-input-options":v.value,onBlur:a=>h(e.name)},null,8,["modelValue","onUpdate:modelValue","text-input-options","onBlur"])]),_:2},1024),p(f,{class:"px-0",style:{width:"20px","max-width":"20px","padding-top":"15px"}},{default:s(()=>[p(E,{size:"24",color:"#1E7D30"},{default:s(()=>[D("mdi-minus")]),_:1})]),_:1}),p(f,null,{default:s(()=>[p(C(q),{class:"flex",position:"left","select-text":"Chọn","cancel-text":"Thoát",modelValue:t.value[e.nameTo],"onUpdate:modelValue":a=>t.value[e.nameTo]=a,"text-input":"",format:V,placeholder:"dd/mm/yyyy","text-input-options":v.value,onBlur:a=>h(e.nameTo)},null,8,["modelValue","onUpdate:modelValue","text-input-options","onBlur"])]),_:2},1024)]),_:2},1024)):i("",!0),e.type==="money"?(n(),u(g,{key:5,class:"flex input-form",onInput:a=>r.toCurrency(e.name),modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,type:"number",placeholder:e.placeHolder,solo:"",dense:"","hide-details":"auto",clearable:!e.readonly,required:e.required,rules:e.required?[a=>a!==""&&a!==null&&a!==void 0||"Thông tin bắt buộc"]:[]},null,8,["onInput","modelValue","onUpdate:modelValue","placeholder","clearable","required","rules"])):i("",!0),e.type==="select"&&!e.api?(n(),u(A,{key:6,class:"flex input-form","hide-no-data":"",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,items:e.dataSource,multiple:e.multiple,"item-title":e.itemText,"item-value":e.itemValue,dense:"",solo:"","hide-details":"auto","return-object":"",clearable:!e.readonly,required:e.required,rules:e.required?[a=>a!==""&&a!==null&&a!==void 0||"Thông tin bắt buộc"]:[]},null,8,["modelValue","onUpdate:modelValue","items","multiple","item-title","item-value","clearable","required","rules"])):i("",!0),e.type==="select"&&e.api?(n(),u(A,{key:7,class:"flex input-form","hide-no-data":"",modelValue:t.value[e.name],"onUpdate:modelValue":a=>t.value[e.name]=a,items:e.dataSource,multiple:e.multiple,"item-title":e.itemText,"item-value":e.itemValue,dense:"",solo:"","hide-details":"auto","return-object":"",clearable:!e.readonly,required:e.required,rules:e.required?[a=>a!==""&&a!==null&&a!==void 0||"Thông tin bắt buộc"]:[]},null,8,["modelValue","onUpdate:modelValue","items","multiple","item-title","item-value","clearable","required","rules"])):i("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{pe as default};
